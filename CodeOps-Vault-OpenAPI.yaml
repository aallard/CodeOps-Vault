openapi: 3.0.3
info:
  title: CodeOps-Vault API
  description: >
    Secret management, access policy, key rotation, dynamic secrets, transit encryption,
    seal/unseal, and audit log service for the CodeOps platform.
  version: 1.0.0
  contact:
    name: CodeOps Team

servers:
  - url: http://localhost:8097
    description: Local development server

security:
  - bearerAuth: []

tags:
  - name: Health
    description: Service health check
  - name: Secrets
    description: Secret CRUD, versioning, metadata, and search
  - name: Policies
    description: Access policies, bindings, and evaluation
  - name: Rotation
    description: Secret rotation policies and execution
  - name: Dynamic Secrets
    description: Dynamic secret lease management
  - name: Transit
    description: Transit encryption-as-a-service
  - name: Seal
    description: Vault seal/unseal operations
  - name: Audit
    description: Audit log queries and statistics

paths:
  # ═══════════════════════════════════════════════════════════════
  # HEALTH
  # ═══════════════════════════════════════════════════════════════
  /health:
    get:
      tags: [Health]
      summary: Health check
      description: Returns service health status. Public endpoint — no authentication required.
      operationId: healthCheck
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: UP
                  service:
                    type: string
                    example: CodeOps-Vault
                  timestamp:
                    type: string
                    format: date-time

  # ═══════════════════════════════════════════════════════════════
  # SECRETS
  # ═══════════════════════════════════════════════════════════════
  /api/v1/vault/secrets:
    post:
      tags: [Secrets]
      summary: Create a new secret
      operationId: createSecret
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSecretRequest'
      responses:
        '201':
          description: Secret created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
    get:
      tags: [Secrets]
      summary: List secrets with filtering and pagination
      operationId: listSecrets
      parameters:
        - name: type
          in: query
          schema:
            $ref: '#/components/schemas/SecretType'
        - name: pathPrefix
          in: query
          schema:
            type: string
        - name: activeOnly
          in: query
          schema:
            type: boolean
        - name: page
          in: query
          schema:
            type: integer
            format: int32
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            format: int32
            default: 20
        - name: sortBy
          in: query
          schema:
            type: string
        - name: sortDir
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Paginated list of secrets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseSecretResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/secrets/{id}:
    get:
      tags: [Secrets]
      summary: Get a secret by ID
      operationId: getSecretById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Secret found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Secret not found
    put:
      tags: [Secrets]
      summary: Update a secret
      operationId: updateSecret
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSecretRequest'
      responses:
        '200':
          description: Secret updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Secret not found
    delete:
      tags: [Secrets]
      summary: Soft-delete a secret
      operationId: deleteSecret
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Secret soft-deleted
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Secret not found

  /api/v1/vault/secrets/{id}/permanent:
    delete:
      tags: [Secrets]
      summary: Permanently delete a secret
      operationId: permanentlyDeleteSecret
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Secret permanently deleted
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Secret not found

  /api/v1/vault/secrets/by-path:
    get:
      tags: [Secrets]
      summary: Get a secret by path
      operationId: getSecretByPath
      parameters:
        - name: path
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Secret found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Secret not found

  /api/v1/vault/secrets/{id}/value:
    get:
      tags: [Secrets]
      summary: Get the current decrypted value of a secret
      operationId: getSecretValue
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Decrypted secret value
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretValueResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Secret not found

  /api/v1/vault/secrets/{id}/versions/{version}/value:
    get:
      tags: [Secrets]
      summary: Get the decrypted value of a specific secret version
      operationId: getSecretVersionValue
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: version
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Decrypted secret value for specified version
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretValueResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Secret or version not found

  /api/v1/vault/secrets/search:
    get:
      tags: [Secrets]
      summary: Search secrets by query string
      operationId: searchSecrets
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
            format: int32
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            format: int32
            default: 20
      responses:
        '200':
          description: Paginated search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseSecretResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/secrets/paths:
    get:
      tags: [Secrets]
      summary: List secret paths matching a prefix
      operationId: listSecretPaths
      parameters:
        - name: prefix
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of matching paths
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/secrets/{id}/versions:
    get:
      tags: [Secrets]
      summary: List versions of a secret
      operationId: listSecretVersions
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            format: int32
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            format: int32
            default: 20
      responses:
        '200':
          description: Paginated list of secret versions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseSecretVersionResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Secret not found

  /api/v1/vault/secrets/{id}/versions/{version}:
    get:
      tags: [Secrets]
      summary: Get a specific secret version
      operationId: getSecretVersion
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: version
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: Secret version details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretVersionResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Secret or version not found
    delete:
      tags: [Secrets]
      summary: Destroy a specific secret version
      operationId: destroySecretVersion
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: version
          in: path
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '204':
          description: Version destroyed
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Secret or version not found

  /api/v1/vault/secrets/{id}/metadata:
    get:
      tags: [Secrets]
      summary: Get all metadata for a secret
      operationId: getSecretMetadata
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Metadata key-value pairs
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: string
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Secret not found

  /api/v1/vault/secrets/{id}/metadata/{key}:
    put:
      tags: [Secrets]
      summary: Set a metadata key-value pair on a secret
      operationId: setSecretMetadataKey
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: key
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: string
      responses:
        '204':
          description: Metadata key set
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Secret not found
    delete:
      tags: [Secrets]
      summary: Remove a metadata key from a secret
      operationId: deleteSecretMetadataKey
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: key
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Metadata key removed
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Secret not found

  /api/v1/vault/secrets/stats:
    get:
      tags: [Secrets]
      summary: Get secret statistics
      operationId: getSecretStats
      responses:
        '200':
          description: Secret statistics
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: integer
                  format: int64
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/secrets/expiring:
    get:
      tags: [Secrets]
      summary: Get secrets expiring within a time window
      operationId: getExpiringSecrets
      parameters:
        - name: withinHours
          in: query
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: List of expiring secrets
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SecretResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  # ═══════════════════════════════════════════════════════════════
  # POLICIES
  # ═══════════════════════════════════════════════════════════════
  /api/v1/vault/policies:
    post:
      tags: [Policies]
      summary: Create a new access policy
      operationId: createPolicy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePolicyRequest'
      responses:
        '201':
          description: Policy created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccessPolicyResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
    get:
      tags: [Policies]
      summary: List access policies with pagination
      operationId: listPolicies
      parameters:
        - name: activeOnly
          in: query
          schema:
            type: boolean
        - name: page
          in: query
          schema:
            type: integer
            format: int32
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            format: int32
            default: 20
      responses:
        '200':
          description: Paginated list of policies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseAccessPolicyResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/policies/{id}:
    get:
      tags: [Policies]
      summary: Get an access policy by ID
      operationId: getPolicyById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Policy found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccessPolicyResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Policy not found
    put:
      tags: [Policies]
      summary: Update an access policy
      operationId: updatePolicy
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePolicyRequest'
      responses:
        '200':
          description: Policy updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccessPolicyResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Policy not found
    delete:
      tags: [Policies]
      summary: Delete an access policy
      operationId: deletePolicy
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Policy deleted
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Policy not found

  /api/v1/vault/policies/bindings:
    post:
      tags: [Policies]
      summary: Create a policy binding
      operationId: createPolicyBinding
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBindingRequest'
      responses:
        '201':
          description: Binding created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PolicyBindingResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/policies/{id}/bindings:
    get:
      tags: [Policies]
      summary: List bindings for a policy
      operationId: listPolicyBindings
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of bindings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PolicyBindingResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Policy not found

  /api/v1/vault/policies/bindings/target:
    get:
      tags: [Policies]
      summary: List bindings for a specific target
      operationId: listBindingsByTarget
      parameters:
        - name: type
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/BindingType'
        - name: targetId
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of bindings for target
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PolicyBindingResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/policies/bindings/{id}:
    delete:
      tags: [Policies]
      summary: Delete a policy binding
      operationId: deletePolicyBinding
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Binding deleted
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Binding not found

  /api/v1/vault/policies/evaluate:
    post:
      tags: [Policies]
      summary: Evaluate access for a user
      operationId: evaluateUserAccess
      parameters:
        - name: userId
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: path
          in: query
          required: true
          schema:
            type: string
        - name: permission
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/PolicyPermission'
      responses:
        '200':
          description: Access decision
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccessDecision'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/policies/evaluate/service:
    post:
      tags: [Policies]
      summary: Evaluate access for a service
      operationId: evaluateServiceAccess
      parameters:
        - name: serviceId
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: path
          in: query
          required: true
          schema:
            type: string
        - name: permission
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/PolicyPermission'
      responses:
        '200':
          description: Access decision
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccessDecision'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/policies/stats:
    get:
      tags: [Policies]
      summary: Get policy statistics
      operationId: getPolicyStats
      responses:
        '200':
          description: Policy statistics
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: integer
                  format: int64
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  # ═══════════════════════════════════════════════════════════════
  # ROTATION
  # ═══════════════════════════════════════════════════════════════
  /api/v1/vault/rotation/policies:
    post:
      tags: [Rotation]
      summary: Create a rotation policy
      operationId: createRotationPolicy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRotationPolicyRequest'
      responses:
        '201':
          description: Rotation policy created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RotationPolicyResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/rotation/policies/{secretId}:
    get:
      tags: [Rotation]
      summary: Get rotation policy by secret ID
      operationId: getRotationPolicyBySecretId
      parameters:
        - name: secretId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Rotation policy found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RotationPolicyResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Rotation policy not found

  /api/v1/vault/rotation/policies/{policyId}:
    put:
      tags: [Rotation]
      summary: Update a rotation policy
      operationId: updateRotationPolicy
      parameters:
        - name: policyId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRotationPolicyRequest'
      responses:
        '200':
          description: Rotation policy updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RotationPolicyResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Rotation policy not found
    delete:
      tags: [Rotation]
      summary: Delete a rotation policy
      operationId: deleteRotationPolicy
      parameters:
        - name: policyId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Rotation policy deleted
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Rotation policy not found

  /api/v1/vault/rotation/rotate/{secretId}:
    post:
      tags: [Rotation]
      summary: Trigger immediate rotation of a secret
      operationId: rotateSecret
      parameters:
        - name: secretId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Rotation executed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RotationHistoryResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Secret or rotation policy not found

  /api/v1/vault/rotation/history/{secretId}:
    get:
      tags: [Rotation]
      summary: Get rotation history for a secret
      operationId: getRotationHistory
      parameters:
        - name: secretId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            format: int32
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            format: int32
            default: 20
      responses:
        '200':
          description: Paginated rotation history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseRotationHistoryResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/rotation/history/{secretId}/last:
    get:
      tags: [Rotation]
      summary: Get the last rotation event for a secret
      operationId: getLastRotation
      parameters:
        - name: secretId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Last rotation event
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RotationHistoryResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: No rotation history found

  /api/v1/vault/rotation/stats/{secretId}:
    get:
      tags: [Rotation]
      summary: Get rotation statistics for a secret
      operationId: getRotationStats
      parameters:
        - name: secretId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Rotation statistics
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: integer
                  format: int64
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  # ═══════════════════════════════════════════════════════════════
  # DYNAMIC SECRETS
  # ═══════════════════════════════════════════════════════════════
  /api/v1/vault/dynamic/leases:
    post:
      tags: [Dynamic Secrets]
      summary: Create a dynamic secret lease
      operationId: createDynamicLease
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDynamicLeaseRequest'
      responses:
        '201':
          description: Lease created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DynamicLeaseResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
    get:
      tags: [Dynamic Secrets]
      summary: List dynamic leases with optional filtering
      operationId: listDynamicLeases
      parameters:
        - name: secretId
          in: query
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            format: int32
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            format: int32
            default: 20
      responses:
        '200':
          description: Paginated list of leases
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseDynamicLeaseResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/dynamic/leases/{leaseId}:
    get:
      tags: [Dynamic Secrets]
      summary: Get a dynamic lease by lease ID
      operationId: getDynamicLease
      parameters:
        - name: leaseId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Lease found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DynamicLeaseResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Lease not found

  /api/v1/vault/dynamic/leases/{leaseId}/revoke:
    post:
      tags: [Dynamic Secrets]
      summary: Revoke a dynamic lease
      operationId: revokeDynamicLease
      parameters:
        - name: leaseId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Lease revoked
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Lease not found

  /api/v1/vault/dynamic/leases/revoke-all:
    post:
      tags: [Dynamic Secrets]
      summary: Revoke all leases for a secret
      operationId: revokeAllDynamicLeases
      parameters:
        - name: secretId
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Revocation count
          content:
            application/json:
              schema:
                type: object
                properties:
                  revoked:
                    type: integer
                    format: int32
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/dynamic/stats:
    get:
      tags: [Dynamic Secrets]
      summary: Get dynamic secret statistics
      operationId: getDynamicStats
      parameters:
        - name: secretId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Dynamic secret statistics
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: integer
                  format: int64
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/dynamic/active-count:
    get:
      tags: [Dynamic Secrets]
      summary: Get count of active leases
      operationId: getActiveLeaseCount
      responses:
        '200':
          description: Active lease count
          content:
            application/json:
              schema:
                type: object
                properties:
                  activeLeases:
                    type: integer
                    format: int64
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  # ═══════════════════════════════════════════════════════════════
  # TRANSIT
  # ═══════════════════════════════════════════════════════════════
  /api/v1/vault/transit/keys:
    post:
      tags: [Transit]
      summary: Create a transit encryption key
      operationId: createTransitKey
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTransitKeyRequest'
      responses:
        '201':
          description: Transit key created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransitKeyResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
    get:
      tags: [Transit]
      summary: List transit keys with pagination
      operationId: listTransitKeys
      parameters:
        - name: activeOnly
          in: query
          schema:
            type: boolean
        - name: page
          in: query
          schema:
            type: integer
            format: int32
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            format: int32
            default: 20
      responses:
        '200':
          description: Paginated list of transit keys
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseTransitKeyResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/transit/keys/{id}:
    get:
      tags: [Transit]
      summary: Get a transit key by ID
      operationId: getTransitKeyById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Transit key found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransitKeyResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Transit key not found
    put:
      tags: [Transit]
      summary: Update a transit key
      operationId: updateTransitKey
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTransitKeyRequest'
      responses:
        '200':
          description: Transit key updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransitKeyResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Transit key not found
    delete:
      tags: [Transit]
      summary: Delete a transit key
      operationId: deleteTransitKey
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Transit key deleted
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Transit key not found

  /api/v1/vault/transit/keys/by-name:
    get:
      tags: [Transit]
      summary: Get a transit key by name
      operationId: getTransitKeyByName
      parameters:
        - name: name
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Transit key found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransitKeyResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Transit key not found

  /api/v1/vault/transit/keys/{id}/rotate:
    post:
      tags: [Transit]
      summary: Rotate a transit key to a new version
      operationId: rotateTransitKey
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Transit key rotated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransitKeyResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Transit key not found

  /api/v1/vault/transit/encrypt:
    post:
      tags: [Transit]
      summary: Encrypt plaintext using a transit key
      operationId: transitEncrypt
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransitEncryptRequest'
      responses:
        '200':
          description: Encrypted ciphertext
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransitEncryptResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/transit/decrypt:
    post:
      tags: [Transit]
      summary: Decrypt ciphertext using a transit key
      operationId: transitDecrypt
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransitDecryptRequest'
      responses:
        '200':
          description: Decrypted plaintext
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransitDecryptResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/transit/rewrap:
    post:
      tags: [Transit]
      summary: Re-encrypt ciphertext with current key version
      operationId: transitRewrap
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransitRewrapRequest'
      responses:
        '200':
          description: Re-encrypted ciphertext
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransitEncryptResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/transit/datakey:
    post:
      tags: [Transit]
      summary: Generate a data encryption key
      operationId: generateDataKey
      parameters:
        - name: keyName
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Generated data key
          content:
            application/json:
              schema:
                type: object
                properties:
                  plaintextKey:
                    type: string
                  ciphertextKey:
                    type: string
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Transit key not found

  /api/v1/vault/transit/stats:
    get:
      tags: [Transit]
      summary: Get transit statistics
      operationId: getTransitStats
      responses:
        '200':
          description: Transit statistics
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: integer
                  format: int64
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  # ═══════════════════════════════════════════════════════════════
  # SEAL
  # ═══════════════════════════════════════════════════════════════
  /api/v1/vault/seal/status:
    get:
      tags: [Seal]
      summary: Get vault seal status
      description: Public endpoint — no authentication required.
      operationId: getSealStatus
      security: []
      responses:
        '200':
          description: Current seal status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SealStatusResponse'

  /api/v1/vault/seal/seal:
    post:
      tags: [Seal]
      summary: Seal the vault
      operationId: sealVault
      responses:
        '200':
          description: Vault sealed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SealStatusResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/seal/unseal:
    post:
      tags: [Seal]
      summary: Unseal the vault with a key share
      operationId: unsealVault
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SealActionRequest'
      responses:
        '200':
          description: Unseal progress or vault unsealed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SealStatusResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/seal/generate-shares:
    post:
      tags: [Seal]
      summary: Generate Shamir key shares
      operationId: generateShares
      responses:
        '200':
          description: Generated shares
          content:
            application/json:
              schema:
                type: object
                properties:
                  shares:
                    type: array
                    items:
                      type: string
                  totalShares:
                    type: integer
                    format: int32
                  threshold:
                    type: integer
                    format: int32
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/seal/info:
    get:
      tags: [Seal]
      summary: Get seal configuration info
      operationId: getSealInfo
      responses:
        '200':
          description: Seal configuration information
          content:
            application/json:
              schema:
                type: object
                additionalProperties: {}
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  # ═══════════════════════════════════════════════════════════════
  # AUDIT
  # ═══════════════════════════════════════════════════════════════
  /api/v1/vault/audit/query:
    get:
      tags: [Audit]
      summary: Query audit log entries
      operationId: queryAuditLog
      parameters:
        - name: userId
          in: query
          schema:
            type: string
            format: uuid
        - name: operation
          in: query
          schema:
            type: string
        - name: path
          in: query
          schema:
            type: string
        - name: resourceType
          in: query
          schema:
            type: string
        - name: resourceId
          in: query
          schema:
            type: string
            format: uuid
        - name: successOnly
          in: query
          schema:
            type: boolean
        - name: startTime
          in: query
          schema:
            type: string
            format: date-time
        - name: endTime
          in: query
          schema:
            type: string
            format: date-time
        - name: page
          in: query
          schema:
            type: integer
            format: int32
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            format: int32
            default: 20
      responses:
        '200':
          description: Paginated audit entries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseAuditEntryResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/audit/resource/{resourceType}/{resourceId}:
    get:
      tags: [Audit]
      summary: Get audit entries for a specific resource
      operationId: getAuditByResource
      parameters:
        - name: resourceType
          in: path
          required: true
          schema:
            type: string
        - name: resourceId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            format: int32
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            format: int32
            default: 20
      responses:
        '200':
          description: Paginated audit entries for resource
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseAuditEntryResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/v1/vault/audit/stats:
    get:
      tags: [Audit]
      summary: Get audit statistics
      operationId: getAuditStats
      responses:
        '200':
          description: Audit statistics
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: integer
                  format: int64
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # ═══════════════════════════════════════════════════════════════
    # ENUMS
    # ═══════════════════════════════════════════════════════════════
    SecretType:
      type: string
      enum: [STATIC, DYNAMIC, REFERENCE]

    PolicyPermission:
      type: string
      enum: [READ, WRITE, DELETE, LIST, ROTATE]

    BindingType:
      type: string
      enum: [USER, TEAM, SERVICE]

    RotationStrategy:
      type: string
      enum: [RANDOM_GENERATE, EXTERNAL_API, CUSTOM_SCRIPT]

    LeaseStatus:
      type: string
      enum: [ACTIVE, EXPIRED, REVOKED]

    SealStatus:
      type: string
      enum: [SEALED, UNSEALED, UNSEALING]

    # ═══════════════════════════════════════════════════════════════
    # REQUEST SCHEMAS
    # ═══════════════════════════════════════════════════════════════
    CreateSecretRequest:
      type: object
      required: [path, name, value, secretType]
      properties:
        path:
          type: string
          maxLength: 500
          pattern: "^/.*"
          description: Hierarchical path (must start with "/")
        name:
          type: string
          maxLength: 200
        value:
          type: string
          description: The secret value (plaintext — encrypted by service layer)
        description:
          type: string
          maxLength: 2000
        secretType:
          $ref: '#/components/schemas/SecretType'
        referenceArn:
          type: string
          maxLength: 500
          description: For REFERENCE type — the external store ARN/URL
        maxVersions:
          type: integer
          format: int32
          minimum: 1
          maximum: 1000
          description: Maximum versions to retain (null = unlimited)
        retentionDays:
          type: integer
          format: int32
          minimum: 1
          description: Days to retain old versions (null = forever)
        expiresAt:
          type: string
          format: date-time
          description: Optional expiration timestamp
        metadata:
          type: object
          additionalProperties:
            type: string
          description: Optional key-value metadata pairs

    UpdateSecretRequest:
      type: object
      properties:
        value:
          type: string
          description: New secret value (if provided, creates a new version)
        changeDescription:
          type: string
          maxLength: 500
          description: Description of what changed in this version
        description:
          type: string
          maxLength: 2000
          description: Updated description (null = no change)
        maxVersions:
          type: integer
          format: int32
          minimum: 1
          maximum: 1000
          description: Updated max versions (null = no change)
        retentionDays:
          type: integer
          format: int32
          minimum: 1
          description: Updated retention days (null = no change)
        expiresAt:
          type: string
          format: date-time
          description: Updated expiration (null = no change)
        metadata:
          type: object
          additionalProperties:
            type: string
          description: Replacement metadata (null = no change, empty map = clear all)

    CreatePolicyRequest:
      type: object
      required: [name, pathPattern, permissions]
      properties:
        name:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 2000
        pathPattern:
          type: string
          maxLength: 500
          description: "Glob pattern for secret paths (e.g., /services/talent-app/*)"
        permissions:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/PolicyPermission'
        isDenyPolicy:
          type: boolean
          description: Whether this policy denies (true) or allows (false) the permissions

    UpdatePolicyRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 2000
        pathPattern:
          type: string
          maxLength: 500
        permissions:
          type: array
          items:
            $ref: '#/components/schemas/PolicyPermission'
        isDenyPolicy:
          type: boolean
        isActive:
          type: boolean

    CreateBindingRequest:
      type: object
      required: [policyId, bindingType, bindingTargetId]
      properties:
        policyId:
          type: string
          format: uuid
        bindingType:
          $ref: '#/components/schemas/BindingType'
        bindingTargetId:
          type: string
          format: uuid
          description: The userId, teamId, or serviceId to bind to

    CreateRotationPolicyRequest:
      type: object
      required: [secretId, strategy, rotationIntervalHours]
      properties:
        secretId:
          type: string
          format: uuid
        strategy:
          $ref: '#/components/schemas/RotationStrategy'
        rotationIntervalHours:
          type: integer
          format: int32
          minimum: 1
          description: How often to rotate (in hours)
        randomLength:
          type: integer
          format: int32
          minimum: 8
          maximum: 1024
          description: For RANDOM_GENERATE — character length
        randomCharset:
          type: string
          maxLength: 100
          description: For RANDOM_GENERATE — allowed characters
        externalApiUrl:
          type: string
          maxLength: 500
          description: For EXTERNAL_API — endpoint URL
        externalApiHeaders:
          type: string
          description: For EXTERNAL_API — JSON headers string
        scriptCommand:
          type: string
          description: For CUSTOM_SCRIPT — command to execute
        maxFailures:
          type: integer
          format: int32
          minimum: 1
          maximum: 100
          description: Max consecutive failures before pausing

    UpdateRotationPolicyRequest:
      type: object
      properties:
        strategy:
          $ref: '#/components/schemas/RotationStrategy'
        rotationIntervalHours:
          type: integer
          format: int32
          minimum: 1
        randomLength:
          type: integer
          format: int32
          minimum: 8
          maximum: 1024
        randomCharset:
          type: string
          maxLength: 100
        externalApiUrl:
          type: string
          maxLength: 500
        externalApiHeaders:
          type: string
        scriptCommand:
          type: string
        maxFailures:
          type: integer
          format: int32
          minimum: 1
          maximum: 100
        isActive:
          type: boolean

    CreateDynamicLeaseRequest:
      type: object
      required: [secretId, ttlSeconds]
      properties:
        secretId:
          type: string
          format: uuid
        ttlSeconds:
          type: integer
          format: int32
          minimum: 60
          maximum: 86400
          description: Requested lease duration in seconds (60-86400)

    RevokeDynamicLeaseRequest:
      type: object
      required: [leaseId]
      properties:
        leaseId:
          type: string
          description: The lease identifier to revoke

    CreateTransitKeyRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          maxLength: 200
          description: Unique key name within the team
        description:
          type: string
          maxLength: 2000
        algorithm:
          type: string
          maxLength: 30
          description: "Encryption algorithm (default: AES-256-GCM)"
        isDeletable:
          type: boolean
          description: "Whether key can be deleted (default: false for safety)"
        isExportable:
          type: boolean
          description: "Whether key material can be exported (default: false)"

    UpdateTransitKeyRequest:
      type: object
      properties:
        description:
          type: string
          maxLength: 2000
        minDecryptionVersion:
          type: integer
          format: int32
          minimum: 1
        isDeletable:
          type: boolean
        isExportable:
          type: boolean
        isActive:
          type: boolean

    TransitEncryptRequest:
      type: object
      required: [keyName, plaintext]
      properties:
        keyName:
          type: string
          maxLength: 200
          description: Name of the transit key to use
        plaintext:
          type: string
          description: Base64-encoded plaintext data

    TransitDecryptRequest:
      type: object
      required: [keyName, ciphertext]
      properties:
        keyName:
          type: string
          maxLength: 200
          description: Name of the transit key to use
        ciphertext:
          type: string
          description: The encrypted data (prefixed with key version)

    TransitRewrapRequest:
      type: object
      required: [keyName, ciphertext]
      properties:
        keyName:
          type: string
          maxLength: 200
          description: Name of the transit key
        ciphertext:
          type: string
          description: Existing ciphertext to rewrap

    SealActionRequest:
      type: object
      required: [action]
      properties:
        action:
          type: string
          pattern: "^(seal|unseal)$"
          description: "\"seal\" or \"unseal\""
        keyShare:
          type: string
          description: For unseal — one of the Shamir key shares

    AuditQueryRequest:
      type: object
      description: Query parameters for searching the audit log. All fields optional.
      properties:
        userId:
          type: string
          format: uuid
        operation:
          type: string
        path:
          type: string
        resourceType:
          type: string
        resourceId:
          type: string
          format: uuid
        successOnly:
          type: boolean
        startTime:
          type: string
          format: date-time
        endTime:
          type: string
          format: date-time

    # ═══════════════════════════════════════════════════════════════
    # RESPONSE SCHEMAS
    # ═══════════════════════════════════════════════════════════════
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
        timestamp:
          type: string

    SecretResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        teamId:
          type: string
          format: uuid
        path:
          type: string
        name:
          type: string
        description:
          type: string
        secretType:
          $ref: '#/components/schemas/SecretType'
        currentVersion:
          type: integer
          format: int32
        maxVersions:
          type: integer
          format: int32
        retentionDays:
          type: integer
          format: int32
        expiresAt:
          type: string
          format: date-time
        lastAccessedAt:
          type: string
          format: date-time
        lastRotatedAt:
          type: string
          format: date-time
        ownerUserId:
          type: string
          format: uuid
        referenceArn:
          type: string
        isActive:
          type: boolean
        metadata:
          type: object
          additionalProperties:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    SecretValueResponse:
      type: object
      properties:
        secretId:
          type: string
          format: uuid
        path:
          type: string
        name:
          type: string
        versionNumber:
          type: integer
          format: int32
        value:
          type: string
        createdAt:
          type: string
          format: date-time

    SecretVersionResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        secretId:
          type: string
          format: uuid
        versionNumber:
          type: integer
          format: int32
        encryptionKeyId:
          type: string
        changeDescription:
          type: string
        createdByUserId:
          type: string
          format: uuid
        isDestroyed:
          type: boolean
        createdAt:
          type: string
          format: date-time

    AccessPolicyResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        teamId:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        pathPattern:
          type: string
        permissions:
          type: array
          items:
            $ref: '#/components/schemas/PolicyPermission'
        isDenyPolicy:
          type: boolean
        isActive:
          type: boolean
        createdByUserId:
          type: string
          format: uuid
        bindingCount:
          type: integer
          format: int32
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PolicyBindingResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        policyId:
          type: string
          format: uuid
        policyName:
          type: string
        bindingType:
          $ref: '#/components/schemas/BindingType'
        bindingTargetId:
          type: string
          format: uuid
        createdByUserId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time

    AccessDecision:
      type: object
      properties:
        allowed:
          type: boolean
        reason:
          type: string
        decidingPolicyId:
          type: string
          format: uuid
        decidingPolicyName:
          type: string

    RotationPolicyResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        secretId:
          type: string
          format: uuid
        secretPath:
          type: string
        strategy:
          $ref: '#/components/schemas/RotationStrategy'
        rotationIntervalHours:
          type: integer
          format: int32
        randomLength:
          type: integer
          format: int32
        randomCharset:
          type: string
        externalApiUrl:
          type: string
        isActive:
          type: boolean
        failureCount:
          type: integer
          format: int32
        maxFailures:
          type: integer
          format: int32
        lastRotatedAt:
          type: string
          format: date-time
        nextRotationAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    RotationHistoryResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        secretId:
          type: string
          format: uuid
        secretPath:
          type: string
        strategy:
          $ref: '#/components/schemas/RotationStrategy'
        previousVersion:
          type: integer
          format: int32
        newVersion:
          type: integer
          format: int32
        success:
          type: boolean
        errorMessage:
          type: string
        durationMs:
          type: integer
          format: int64
        triggeredByUserId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time

    DynamicLeaseResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        leaseId:
          type: string
        secretId:
          type: string
          format: uuid
        secretPath:
          type: string
        backendType:
          type: string
        status:
          $ref: '#/components/schemas/LeaseStatus'
        ttlSeconds:
          type: integer
          format: int32
        expiresAt:
          type: string
          format: date-time
        revokedAt:
          type: string
          format: date-time
        requestedByUserId:
          type: string
          format: uuid
        connectionDetails:
          type: object
          additionalProperties: {}
        createdAt:
          type: string
          format: date-time

    TransitKeyResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        teamId:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        currentVersion:
          type: integer
          format: int32
        minDecryptionVersion:
          type: integer
          format: int32
        algorithm:
          type: string
        isDeletable:
          type: boolean
        isExportable:
          type: boolean
        isActive:
          type: boolean
        createdByUserId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TransitEncryptResponse:
      type: object
      properties:
        keyName:
          type: string
        keyVersion:
          type: integer
          format: int32
        ciphertext:
          type: string

    TransitDecryptResponse:
      type: object
      properties:
        keyName:
          type: string
        plaintext:
          type: string

    SealStatusResponse:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/SealStatus'
        totalShares:
          type: integer
          format: int32
        threshold:
          type: integer
          format: int32
        sharesProvided:
          type: integer
          format: int32
        autoUnsealEnabled:
          type: boolean
        sealedAt:
          type: string
          format: date-time
        unsealedAt:
          type: string
          format: date-time

    AuditEntryResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        teamId:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        operation:
          type: string
        path:
          type: string
        resourceType:
          type: string
        resourceId:
          type: string
          format: uuid
        success:
          type: boolean
        errorMessage:
          type: string
        ipAddress:
          type: string
        correlationId:
          type: string
        createdAt:
          type: string
          format: date-time

    # ═══════════════════════════════════════════════════════════════
    # PAGE RESPONSE VARIANTS
    # ═══════════════════════════════════════════════════════════════
    PageResponseSecretResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/SecretResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseSecretVersionResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/SecretVersionResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseAccessPolicyResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/AccessPolicyResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseRotationHistoryResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/RotationHistoryResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseDynamicLeaseResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/DynamicLeaseResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseTransitKeyResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/TransitKeyResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseAuditEntryResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/AuditEntryResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean
